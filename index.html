<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Calendário Econômico · Guia WDO (Clean Dark)</title>
<style>
:root{
  --bg:#0b0c10;--panel:#101218;--panel-2:#0f1117;
  --border:#1c2030;--ink:#e8eaf2;--muted:#aab3c5;
  --radius:14px;--shadow:0 6px 18px rgba(0,0,0,.35);
}
body{margin:0;padding:20px;font-family:Inter,Segoe UI,Roboto,sans-serif;background:var(--bg);color:var(--ink);}
.container{max-width:1200px;margin:0 auto;}
h1{margin:0 0 8px;font-size:26px;}
.toolbar{display:grid;grid-template-columns:1.5fr 1fr 1fr auto auto;gap:10px;margin-bottom:12px;}
input,select,button{border-radius:10px;border:1px solid var(--border);background:#101218;color:var(--ink);padding:8px;}
button.primary{background:#1a2332;border-color:#283246;}
.table-wrap{overflow:auto;background:var(--panel);border-radius:var(--radius);}
table{width:100%;border-collapse:collapse;min-width:1000px;}
th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,.05);}
th{position:sticky;top:0;background:#141926;}
tbody tr:nth-child(odd){background:rgba(255,255,255,.02);}
tbody tr:hover{background:rgba(110,168,254,.06);}
.editable td[contenteditable]{outline:2px dashed #2b3b58;background:#111725;}
</style>
</head>
<body>
<div class="container">
  <h1>Calendário Econômico – Guia WDO</h1>
  <div class="toolbar">
    <input type="text" id="q" placeholder="Buscar...">
    <select id="cat"><option value="">Todas categorias</option><option>Inflação</option><option>Emprego</option></select>
    <select id="freq"><option value="">Todas frequências</option><option>Mensal</option><option>Semanal</option></select>
    <button id="btnImport">Importar CSV</button>
    <button class="primary" id="btnExport">Exportar CSV</button>
  </div>

  <div class="table-wrap">
    <table id="grid">
      <thead>
        <tr>
          <th>Categoria</th>
          <th>Indicador</th>
          <th>Frequência</th>
          <th>Quando</th>
          <th>Hora</th>
          <th>Acima</th>
          <th>Em linha</th>
          <th>Abaixo</th>
          <th>WDO</th>
          <th>Paralelo</th>
          <th>Estratégia</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>
  </div>
</div>

<input type="file" id="fileInput" accept=".csv" style="display:none"/>

<script>
const DEFAULT_DATA = [
  {Categoria:"Inflação", Indicador:"CPI", Frequência:"Mensal", Quando:"2ª semana", Hora:"09:30", Acima:"Pressão ↑", "Em linha":"Neutro", Abaixo:"Desinflação ↓", WDO:"⬆️ / ⬇️", Paralelo:"Juros ↑ / ↓", Estratégia:"Operar impulso inicial"},
  {Categoria:"Inflação", Indicador:"Core CPI", Frequência:"Mensal", Quando:"2ª semana", Hora:"09:30", Acima:"Alta ↑", "Em linha":"Neutro", Abaixo:"Baixa ↓", WDO:"⬆️ / ⬇️", Paralelo:"Juros ↑ / ↓", Estratégia:"Priorizar núcleo"},
  {Categoria:"Emprego", Indicador:"Payroll", Frequência:"Mensal", Quando:"1ª sexta", Hora:"09:30", Acima:"Surpresa ↑", "Em linha":"Neutro", Abaixo:"Fraco ↓", WDO:"⬆️ / ⬇️", Paralelo:"Ações ↑ / ↓", Estratégia:"Seguir tendência inicial"}
];

const STORAGE_KEY = 'wdo_guide_data_v2';
let DATA = JSON.parse(localStorage.getItem(STORAGE_KEY)||'null')||DEFAULT_DATA;

function saveData(){localStorage.setItem(STORAGE_KEY,JSON.stringify(DATA));}
function render(rows){
  const tbody = document.getElementById('tbody');
  tbody.innerHTML='';
  rows.forEach((r,idx)=>{
    const tr=document.createElement('tr');
    Object.keys(r).forEach(k=>{
      const td=document.createElement('td');
      td.textContent=r[k];
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });
}

function applyFilters(){
  const q=document.getElementById('q').value.toLowerCase();
  const cat=document.getElementById('cat').value;
  const freq=document.getElementById('freq').value;
  let rows=DATA.filter(r=>{
    if(q && !Object.values(r).join(" ").toLowerCase().includes(q)) return false;
    if(cat && r.Categoria!==cat) return false;
    if(freq && r.Frequência!==freq) return false;
    return true;
  });
  render(rows);
}

document.getElementById('q').addEventListener('input',applyFilters);
document.getElementById('cat').addEventListener('change',applyFilters);
document.getElementById('freq').addEventListener('change',applyFilters);

document.getElementById('btnExport').addEventListener('click',()=>{
  const headers=Object.keys(DATA[0]);
  const csv=[headers.join(',')].concat(DATA.map(r=>headers.map(h=>`"${r[h]}"`).join(','))).join('\n');
  const blob=new Blob([csv],{type:'text/csv'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='guia_wdo.csv'; a.click();
});

document.getElementById('btnImport').addEventListener('click',()=>document.getElementById('fileInput').click());
document.getElementById('fileInput').addEventListener('change',e=>{
  const file=e.target.files[0]; if(!file)return;
  const reader=new FileReader();
  reader.onload=()=> {
    const lines=reader.result.split(/\r?\n/).filter(Boolean);
    const headers=lines[0].split(',');
    DATA=lines.slice(1).map(l=>{
      const vals=l.split(',').map(v=>v.replace(/^"|"$/g,''));
      const obj={};
      headers.forEach((h,i)=>obj[h]=vals[i]);
      return obj;
    });
    saveData(); applyFilters();
  };
  reader.readAsText(file);
});

render(DATA);
</script>
</body>
</html>
